@model dawazon2._0.Models.AdminUserListViewModel

@{
    ViewData["Title"] = "Usuarios Admin";
}

<div class="container my-5">

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <div class="card shadow-sm border-0 rounded-4">

        <div class="card-header bg-white border-0 pt-4 pb-2 px-4 d-flex align-items-center justify-content-between">
            <h4 class="fw-bold mb-0">
                <i class="bi bi-people-fill me-2 text-primary"></i>Usuarios Admin
            </h4>
            <span class="badge bg-secondary">@Model.TotalElements usuarios activos</span>
        </div>

        <div class="card-body px-4 pb-4">
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th scope="col">Nombre</th>
                            <th scope="col">Email</th>
                            <th scope="col">Roles</th>
                            <th scope="col">Estado</th>
                            <th scope="col" class="text-end">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var user in Model.Users)
                        {
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center gap-2">
                                        <img src="~/img/defaultImg.png" alt="avatar"
                                             class="rounded-circle"
                                             style="width: 38px; height: 38px; object-fit: cover;">
                                        <div>
                                            <div class="fw-semibold">@(string.IsNullOrWhiteSpace(user.Nombre) ? "Sin nombre" : user.Nombre)</div>
                                            <div class="text-muted small">@user.Email?.Split('@')[0]</div>
                                        </div>
                                    </div>
                                </td>
                                <td class="text-muted small">@user.Email</td>
                                <td>
                                    @foreach (var rol in user.Roles)
                                    {
                                        <span class="badge bg-dark text-uppercase" style="font-size: 0.65rem;">@rol</span>
                                    }
                                </td>
                                <td>
                                    <span class="badge bg-success-subtle text-success border border-success-subtle px-2 py-1">
                                        Activo
                                    </span>
                                </td>
                                <td class="text-end">
                                    <div class="d-flex gap-1 justify-content-end flex-wrap">

                                        @* Ver *@
                                        <a href="/admin/usuarios/@user.Id"
                                           class="btn btn-sm btn-outline-primary"
                                           title="Ver detalle">
                                            <i class="bi bi-eye me-1"></i>Ver
                                        </a>

                                        @* Editar *@
                                        <a href="/admin/usuarios/@user.Id/editar"
                                           class="btn btn-sm btn-warning"
                                           title="Editar usuario">
                                            <i class="bi bi-pencil me-1"></i>Editar
                                        </a>

                                        @* Eliminar (soft delete) *@
                                        <form action="/admin/usuarios/@user.Id/eliminar"
                                              method="post"
                                              onsubmit="return confirm('¿Seguro que deseas desactivar al usuario @user.Email?')">
                                            @Html.AntiForgeryToken()
                                            <button type="submit"
                                                    class="btn btn-sm btn-outline-danger"
                                                    title="Desactivar usuario">
                                                <i class="bi bi-person-x"></i>
                                            </button>
                                        </form>

                                    </div>
                                </td>
                            </tr>
                        }

                        @if (!Model.Users.Any())
                        {
                            <tr>
                                <td colspan="5" class="text-center text-muted py-4">
                                    <i class="bi bi-inbox fs-3 d-block mb-2"></i>No hay usuarios activos.
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            @* ── Paginación ── *@
            @if (Model.TotalPages > 1)
            {
                <nav aria-label="Paginación de usuarios" class="mt-3">
                    <ul class="pagination justify-content-center">
                        <li class="page-item @(Model.PageNumber == 0 ? "disabled" : "")">
                            <a class="page-link" href="/admin/usuarios?page=0&size=@Model.PageSize">«</a>
                        </li>
                        <li class="page-item @(Model.PageNumber == 0 ? "disabled" : "")">
                            <a class="page-link" href="/admin/usuarios?page=@(Model.PageNumber - 1)&size=@Model.PageSize">‹</a>
                        </li>
                        <li class="page-item active">
                            <span class="page-link">Pág. @(Model.PageNumber + 1) / @Model.TotalPages</span>
                        </li>
                        <li class="page-item @(Model.PageNumber >= Model.TotalPages - 1 ? "disabled" : "")">
                            <a class="page-link" href="/admin/usuarios?page=@(Model.PageNumber + 1)&size=@Model.PageSize">›</a>
                        </li>
                        <li class="page-item @(Model.PageNumber >= Model.TotalPages - 1 ? "disabled" : "")">
                            <a class="page-link" href="/admin/usuarios?page=@(Model.TotalPages - 1)&size=@Model.PageSize">»</a>
                        </li>
                    </ul>
                </nav>
                <p class="text-center text-muted small">
                    Mostrando @Model.Users.Count de @Model.TotalElements usuarios
                </p>
            }
        </div>
    </div>
</div>
